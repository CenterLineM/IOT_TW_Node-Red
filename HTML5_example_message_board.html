// HTML5 本地儲存 留言板
// Javascript 練習
<!DOCTYPE html>
<html>
<head>
	<title> HTML5 每日一練 之 JS API-LocalStorage | 留言板 (W3Cfuns.com)</title>
</head>
<script type="text/javascript">
	
	var Storage = {

		saveData:function() // 保存數據
		{
			var data = document.querySelector("#post textarea");
		if(data.value != ""){

			// getTime 是 Date 對象中的方法，作用是返回 現今時間
			var time = new Date().getTime() + Math.random() * 5;

			// 將毫秒數存入key值中，可以降低 Key 重複率
			localStorage.setItem(time, data.value + "I" + this.getDateTime())
			data.value="";
			this.writeData();


		}
		else
		{
			alert("請填寫留言!");
		}
	},
	writeData:function()// 輸出數據
	{

		var dataHtml = "", data = "";
		// 效率高的循環方法
		for(var i = localStorage.length - 1 ; i> 0 ; i -- ){

			data = localStorage.getItem(localStorage(i).split("l"));
			dataHtml += "<p><span class=\"msg\">" + data[0] + "</span><span class=\" datetime\">" + data[1] + "</span></p>";

		}

		document.getElementByld("comment").innerHTML = dataHtml;

	},
	// 清空數據
	clearData:function()
	{
		if(localStorage.length > 0)
		{
			if(window.confirm("清空不可恢復，是否確認清空?"))
			{
				localStorage.clear();
				this.writeData();
			}
		}
		else
		{
			alert("沒有需要清空的數據!");
		}
	},
	//獲取時間日期
	getDateTime:function()
	{
		// 私有方法，自動補 0
		var isZero = function(num)
		{
			if(num < 10)
			{
				num = "0" + num;
			}
			return num;
		}

		var d = new date();
		return d.getFullYear() + "-" + isZero(d.getMonth() +  1) + "-" + d.getDate() + "" + d.getHours() + ":" + d.getSeconds() ;
	}

}

window.onload = function()
{
	//當打開頁面時 ， 先將 localStorage 中的數據輸出一邊 如果沒數據 則輸出空
	Storage.writeData();

	// 發表評論 加 點擊事件按鈕 ， 作用是將localStorage 中的 數據輸出
	document.getElementByld("postBt").onclick = function()
	{
		Storage.saveData();
	}
	// 清空所有保存數據
	document.getElementByld("clearBt").onclick = function()
	{

		Storage.clearData();
	}
}

		





</script>


<body>
<div = "content">
<div = "post">
	<textarea class="transition"></textarea>
	<input id="postBt" type="button" value="留言"></input>
	<input id="clearBt" type="button" value="清空留言"></input>
</div>	
<div id="comment"></div>
</div>


</body>
</html>